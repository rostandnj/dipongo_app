{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/macbookpro/Projects/web/dipongo_app/store.js\";\nimport React, { createContext, useContext, ReactNode, useState, useEffect } from \"react\";\nimport { useRouter } from 'next/router';\nimport jwt_decode from \"jwt-decode\";\nimport axios from \"axios\";\nimport { URL } from \"./urlapi\";\nimport { message } from \"antd\";\nimport useSocket from \"./useSocket\";\nimport music from \"./public/musique-ambiance.mp3\";\nimport musicWrong from \"./public/wrong.mp3\";\nimport musicCorrect from \"./public/correct.mp3\";\nconst authContextDefaultValues = {\n  session: null,\n  updateSession: () => {},\n  deleteSession: () => {},\n  initSession: () => {},\n  firstClick: () => {},\n  stopMusic: () => {}\n};\nconst AuthContext = /*#__PURE__*/createContext(authContextDefaultValues);\nexport function useAuth() {\n  return useContext(AuthContext);\n}\nexport function AuthProvider({\n  children\n}) {\n  const getCookie = name => {\n    if (false) {\n      var re = new RegExp(name + \"=([^;]+)\");\n      var value = re.exec(document.cookie);\n      return value != null ? unescape(value[1]) : null;\n    }\n  };\n\n  const setCookie = (name, value) => {\n    if (false) {\n      var expires = \"\";\n      var date = new Date();\n      date.setTime(date.getTime() + 365 * 24 * 60 * 60 * 1000);\n      expires = \"; expires=\" + date.toUTCString();\n      document.cookie = name + \"=\" + (value || \"\") + expires + \"; path=/\";\n    }\n  };\n\n  const {\n    0: session,\n    1: setSession\n  } = useState(null);\n  const {\n    0: isPlaying,\n    1: setIsPlaying\n  } = useState(false);\n\n  const updateSession = s => {\n    if (false) {\n      if (s !== undefined && s.running_session !== undefined && s.running_session !== null) {\n        localStorage.setItem(\"session\", JSON.stringify(s.running_session));\n        setSession({\n          session: s.running_session\n        });\n      } else {\n        localStorage.setItem(\"session\", null);\n        router.push('/onboard').then(r => {});\n      }\n    }\n  };\n\n  const deleteSession = () => {\n    if (false) {\n      stopMusic();\n      setSession(null);\n      const token = localStorage.getItem(\"token\");\n      localStorage.removeItem(\"user\");\n      localStorage.removeItem(\"token\");\n      setCookie(\"token\", \"null\");\n      localStorage.removeItem(\"session\");\n\n      if (token !== null) {\n        axios.get(URL + '/api/leave/game', {\n          headers: {\n            'Authorization': 'Bearer ' + token\n          }\n        }).then(result => {\n          router.push('/').then(res => {});\n        }).catch(error => {\n          router.push('/').then(res => {});\n        });\n      } else {\n        router.push('/').then(res => {});\n      }\n    }\n  };\n\n  const initSession = data => {\n    if (false) {\n      if (data.running_session === null) {\n        localStorage.setItem(\"session\", null);\n      } else {\n        localStorage.setItem(\"session\", JSON.stringify(data.running_session));\n      }\n\n      localStorage.setItem(\"token\", data.token);\n      setCookie(\"token\", data.token);\n      localStorage.setItem(\"user\", JSON.stringify(data.user));\n    }\n\n    setSession(data);\n\n    if (data.running_session !== null) {\n      router.push('/roadmap');\n    } else {\n      router.push('/onboard');\n    }\n  };\n\n  const clearStorage = () => {\n    localStorage.removeItem(\"user\");\n    localStorage.removeItem(\"token\");\n    setCookie(\"token\", null);\n    localStorage.removeItem(\"session\");\n  };\n\n  const firstClick = () => {\n    if (!isPlaying) {\n      console.log('click');\n      setIsPlaying(true);\n      const audioEl = document.getElementsByClassName(\"audio-element-base\")[0];\n      audioEl.play().then(e => {\n        console.log('play');\n      });\n    }\n    /*else{\n        setIsPlaying(false)\n    }*/\n\n  };\n\n  const stopMusic = () => {\n    if (isPlaying) {\n      setIsPlaying(false);\n      const audioEl = document.getElementsByClassName(\"audio-element-base\")[0];\n      audioEl.pause();\n    }\n    /*else{\n        setIsPlaying(false)\n    }*/\n\n  };\n\n  const value = {\n    session,\n    updateSession,\n    deleteSession,\n    initSession,\n    firstClick,\n    stopMusic\n  };\n  let isAuth = false;\n  const publicPath = ['/', '/login', '/signin'];\n  const router = useRouter();\n  useEffect(() => {\n    if (false) {\n      isAuth = localStorage.getItem(\"user\") !== null;\n\n      if (!isAuth) {\n        deleteSession();\n      } else {\n        let token = localStorage.getItem(\"token\");\n        let deT = jwt_decode(token);\n        let exp = deT.exp;\n        let time = Date.now() / 1000;\n\n        if (time > exp) {\n          router.push('/login');\n        } else {\n          axios.get(URL + '/api/user/info', {\n            headers: {\n              'Authorization': 'Bearer ' + token\n            }\n          }).then(result => {\n            if (result.data.data.running_session !== null) {\n              /*if(result.data.data.running_session.current_time < 3000 && result.data.data.running_session.question_done < 50 ){\n                   router.push('/roadmap')\n              }\n              else{\n                  if(result.data.data.running_session.question_done === 50){\n                      router.push('/win')\n                  }\n                  else{\n                      router.push('/lost')\n                  }\n              }*/\n              setSession({\n                session: result.data.data.running_session\n              });\n              localStorage.setItem(\"session\", JSON.stringify(result.data.data.running_session));\n\n              if (router.pathname === '/') {\n                router.push('/roadmap');\n              } else {\n                if (router.pathname.includes('onboard')) {\n                  router.push('/roadmap');\n                }\n              }\n            } else {\n              setSession({\n                session: null\n              });\n              localStorage.removeItem(\"session\");\n              router.push('/onboard');\n            }\n          }).catch(error => {\n            console.log(error);\n\n            if (error.response) {\n              if (error.response.data.code === \"invalid_jwt_token\") {\n                deleteSession();\n              } //message.warning(error.response.data.message)\n\n            } else if (error.request) {\n              console.log(error.request);\n            } else {\n              console.log('Error', error);\n            }\n          });\n        }\n      }\n    }\n  }, []);\n  const {\n    0: messages,\n    1: setMessages\n  } = useState([]);\n  const {\n    0: message,\n    1: setMessage\n  } = useState([]);\n  const socket = useSocket();\n  useEffect(() => {\n    axios.interceptors.response.use(res => {\n      // Add configurations here\n      if (res.config.method === \"post\" && res.config.url.includes('answer/question')) {\n        if (res.status === 200) {\n          if (res.data.data !== undefined && res.data.data.answer !== undefined && res.data.data.answer.is_true === true) {\n            document.getElementsByClassName(\"audio-correct\")[0].play().then(() => {});\n          } else {\n            document.getElementsByClassName(\"audio-wrong\")[0].play().then(() => {});\n          }\n        }\n      }\n\n      return res;\n    }, err => {\n      return Promise.reject(err);\n    });\n  }, []);\n  useEffect(() => {\n    if (false) {\n      //const audioEl = document.getElementsByClassName(\"audio-element-base\")[0];\n      //audioEl.muted = true;\n      //audioEl.play().then((e)=>{console.log('play')});\n      if (socket && localStorage.getItem(\"token\") !== null) {\n        socket.emit('user_online', {\n          token: localStorage.getItem(\"token\")\n        });\n      }\n    }\n  }, [socket]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"audio\", {\n      className: \"audio-element-base\",\n      loop: true,\n      children: /*#__PURE__*/_jsxDEV(\"source\", {\n        src: music,\n        type: \"audio/mpeg\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 271,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 270,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"audio\", {\n      className: \"audio-wrong\",\n      children: /*#__PURE__*/_jsxDEV(\"source\", {\n        src: musicWrong,\n        type: \"audio/mpeg\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 274,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 273,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"audio\", {\n      className: \"audio-correct\",\n      children: /*#__PURE__*/_jsxDEV(\"source\", {\n        src: musicCorrect,\n        type: \"audio/mpeg\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 277,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 276,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n      value: value,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        onClick: () => {\n          firstClick();\n        },\n        children: children\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 280,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 279,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true);\n}","map":{"version":3,"sources":["/Users/macbookpro/Projects/web/dipongo_app/store.js"],"names":["React","createContext","useContext","ReactNode","useState","useEffect","useRouter","jwt_decode","axios","URL","message","useSocket","music","musicWrong","musicCorrect","authContextDefaultValues","session","updateSession","deleteSession","initSession","firstClick","stopMusic","AuthContext","useAuth","AuthProvider","children","getCookie","name","re","RegExp","value","exec","document","cookie","unescape","setCookie","expires","date","Date","setTime","getTime","toUTCString","setSession","isPlaying","setIsPlaying","s","undefined","running_session","localStorage","setItem","JSON","stringify","router","push","then","r","token","getItem","removeItem","get","headers","result","res","catch","error","data","user","clearStorage","console","log","audioEl","getElementsByClassName","play","e","pause","isAuth","publicPath","deT","exp","time","now","pathname","includes","response","code","request","messages","setMessages","setMessage","socket","interceptors","use","config","method","url","status","answer","is_true","err","Promise","reject","emit"],"mappings":"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","sourcesContent":["import React, {createContext, useContext, ReactNode, useState, useEffect} from \"react\";\nimport { useRouter } from 'next/router'\nimport jwt_decode from \"jwt-decode\";\nimport axios from \"axios\";\nimport {URL} from \"./urlapi\";\nimport {message} from \"antd\";\nimport useSocket from \"./useSocket\";\nimport music from \"./public/musique-ambiance.mp3\";\nimport musicWrong from \"./public/wrong.mp3\";\nimport musicCorrect from \"./public/correct.mp3\";\n\nconst authContextDefaultValues = {\n    session: null,\n    updateSession: () => {},\n    deleteSession: () => {},\n    initSession: () => {},\n    firstClick: () => {},\n    stopMusic: () => {},\n};\nconst AuthContext = createContext(authContextDefaultValues);\n\nexport function useAuth() {\n    return useContext(AuthContext);\n}\n\nexport function AuthProvider({ children }) {\n\n\n    const getCookie = (name) =>\n    {\n        if (typeof window !== \"undefined\"){\n            var re = new RegExp(name + \"=([^;]+)\");\n            var value = re.exec(document.cookie);\n            return (value != null) ? unescape(value[1]) : null;\n        }\n\n    }\n\n    const setCookie = (name,value)=> {\n        if (typeof window !== \"undefined\"){\n            var expires = \"\";\n            var date = new Date();\n            date.setTime(date.getTime() + (365*24*60*60*1000));\n            expires = \"; expires=\" + date.toUTCString();\n            document.cookie = name + \"=\" + (value || \"\")  + expires + \"; path=/\";\n        }\n    }\n    const [session, setSession] = useState(null);\n    const [isPlaying, setIsPlaying] = useState(false);\n    const updateSession = (s) => {\n        if (typeof window !== \"undefined\"){\n            if(s!== undefined && s.running_session !== undefined && s.running_session!==null){\n                localStorage.setItem(\"session\",JSON.stringify(s.running_session));\n                setSession({session: s.running_session});\n            }\n            else{\n                localStorage.setItem(\"session\",null)\n                router.push('/onboard').then((r)=>{})\n            }\n\n        }\n    };\n    const deleteSession = () => {\n        if (typeof window !== \"undefined\"){\n            stopMusic();\n            setSession(null);\n            const token = localStorage.getItem(\"token\")\n            localStorage.removeItem(\"user\");\n            localStorage.removeItem(\"token\");\n            setCookie(\"token\",\"null\")\n            localStorage.removeItem(\"session\");\n            if(token!== null){\n                axios.get(URL + '/api/leave/game', {\n                    headers: {\n                        'Authorization': 'Bearer ' + token\n                    }\n                }).then((result)=>{\n                    router.push('/').then((res)=>{})\n                }).catch((error)=>{\n                    router.push('/').then((res)=>{})\n                });\n            }\n            else{\n                router.push('/').then((res)=>{})\n            }\n\n\n        }\n\n\n    };\n    const initSession = (data) => {\n        if (typeof window !== \"undefined\"){\n            if(data.running_session === null){\n                localStorage.setItem(\"session\",null);\n            }else{\n                localStorage.setItem(\"session\",JSON.stringify(data.running_session));\n            }\n            localStorage.setItem(\"token\",data.token);\n            setCookie(\"token\",data.token);\n            localStorage.setItem(\"user\",JSON.stringify(data.user));\n\n        }\n        setSession(data);\n        if(data.running_session !== null){\n           router.push('/roadmap')\n        }\n        else{\n           router.push('/onboard')\n        }\n    };\n    const clearStorage = () => {\n        localStorage.removeItem(\"user\");\n        localStorage.removeItem(\"token\");\n        setCookie(\"token\",null)\n        localStorage.removeItem(\"session\");\n    };\n    const firstClick = ()=>{\n        if(!isPlaying){\n            console.log('click')\n            setIsPlaying(true)\n            const audioEl = document.getElementsByClassName(\"audio-element-base\")[0];\n            audioEl.play().then((e)=>{console.log('play')});\n        }\n        /*else{\n            setIsPlaying(false)\n        }*/\n\n    };\n    const stopMusic = ()=>{\n        if(isPlaying){\n            setIsPlaying(false)\n            const audioEl = document.getElementsByClassName(\"audio-element-base\")[0];\n            audioEl.pause();\n        }\n        /*else{\n            setIsPlaying(false)\n        }*/\n\n    };\n    const value = {\n        session,\n        updateSession,\n        deleteSession,\n        initSession,\n        firstClick,\n        stopMusic\n    };\n    let isAuth = false;\n    const publicPath = ['/','/login','/signin'];\n    const router = useRouter()\n    useEffect(() => {\n        if (typeof window !== \"undefined\"){\n            isAuth  = localStorage.getItem(\"user\") !== null;\n           if(!isAuth){\n               deleteSession();\n           }\n           else{\n               let token = localStorage.getItem(\"token\");\n               let deT = jwt_decode(token);\n               let exp = deT.exp;\n               let time = Date.now()/1000;\n               if(time > exp){\n                   router.push('/login')\n               }\n               else\n               {\n                       axios.get(URL + '/api/user/info', {\n                           headers: {\n                               'Authorization': 'Bearer ' + token\n                           }\n                       }).then((result)=>{\n\n                          if(result.data.data.running_session !== null){\n\n                              /*if(result.data.data.running_session.current_time < 3000 && result.data.data.running_session.question_done < 50 ){\n\n                                  router.push('/roadmap')\n                              }\n                              else{\n                                  if(result.data.data.running_session.question_done === 50){\n                                      router.push('/win')\n                                  }\n                                  else{\n                                      router.push('/lost')\n                                  }\n                              }*/\n\n                              setSession({session: result.data.data.running_session})\n                              localStorage.setItem(\"session\",JSON.stringify(result.data.data.running_session))\n                             if(router.pathname === '/'){\n                                  router.push('/roadmap')\n                              }\n                                else{\n                                  if(router.pathname.includes('onboard')){\n                                      router.push('/roadmap')\n                                  }\n                              }\n\n                          }\n                          else{\n                              setSession({session: null})\n                              localStorage.removeItem(\"session\")\n                              router.push('/onboard')\n                          }\n\n                       }).catch((error)=>{\n                           console.log(error)\n                           if (error.response) {\n                               if(error.response.data.code === \"invalid_jwt_token\"){\n                                   deleteSession();\n                               }\n                               //message.warning(error.response.data.message)\n                           } else if (error.request) {\n                               console.log(error.request)\n                           } else {\n                               console.log('Error', error)\n                           }\n\n                       });\n               }\n           }\n        }\n\n    }, [])\n    const [messages, setMessages] = useState([]);\n    const [message, setMessage] = useState([]);\n    const socket = useSocket();\n\n    useEffect(()=>{\n        axios.interceptors.response.use(\n            (res) => {\n                // Add configurations here\n                if(res.config.method === \"post\" && res.config.url.includes('answer/question')){\n                    if (res.status === 200) {\n                        if(res.data.data !== undefined && res.data.data.answer !== undefined && res.data.data.answer.is_true === true){\n                            document.getElementsByClassName(\"audio-correct\")[0].play().then(()=>{});\n                        }\n                        else{\n                            document.getElementsByClassName(\"audio-wrong\")[0].play().then(()=>{});\n                        }\n\n                    }\n                }\n\n                return res;\n            },\n            (err) => {\n                return Promise.reject(err);\n            }\n        );\n    },[]);\n\n\n    useEffect(() => {\n\n        if (typeof window !== \"undefined\"){\n            //const audioEl = document.getElementsByClassName(\"audio-element-base\")[0];\n            //audioEl.muted = true;\n            //audioEl.play().then((e)=>{console.log('play')});\n            if (socket && localStorage.getItem(\"token\")!==null) {\n                socket.emit('user_online', {token: localStorage.getItem(\"token\")});\n            }\n        }\n\n    }, [socket]);\n\n    return (\n        <>\n            <audio className=\"audio-element-base\" loop>\n                <source src={music} type=\"audio/mpeg\"></source>\n            </audio>\n            <audio className=\"audio-wrong\">\n                <source src={musicWrong} type=\"audio/mpeg\"></source>\n            </audio>\n            <audio className=\"audio-correct\">\n                <source src={musicCorrect} type=\"audio/mpeg\"></source>\n            </audio>\n            <AuthContext.Provider value={value}>\n                <div onClick={()=>{firstClick()}}>\n                    {children}\n                </div>\n            </AuthContext.Provider>\n        </>\n    );\n}\n"]},"metadata":{},"sourceType":"module"}