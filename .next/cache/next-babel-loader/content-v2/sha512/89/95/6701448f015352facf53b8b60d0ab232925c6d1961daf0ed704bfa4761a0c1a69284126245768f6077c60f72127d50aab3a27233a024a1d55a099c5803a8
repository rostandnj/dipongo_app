{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { createContext, useContext, ReactNode, useState, useEffect } from \"react\";\nimport { useRouter } from 'next/router';\nimport jwt_decode from \"jwt-decode\";\nimport axios from \"axios\";\nimport { URL } from \"./urlapi\";\nimport { message } from \"antd\";\nimport useSocket from \"./useSocket\";\nconst authContextDefaultValues = {\n  session: null,\n  updateSession: () => {},\n  deleteSession: () => {},\n  initSession: () => {}\n};\nconst AuthContext = /*#__PURE__*/createContext(authContextDefaultValues);\nexport function useAuth() {\n  return useContext(AuthContext);\n}\nexport function AuthProvider({\n  children\n}) {\n  const getCookie = name => {\n    if (false) {\n      var re = new RegExp(name + \"=([^;]+)\");\n      var value = re.exec(document.cookie);\n      return value != null ? unescape(value[1]) : null;\n    }\n  };\n\n  const setCookie = (name, value) => {\n    if (false) {\n      var expires = \"\";\n      var date = new Date();\n      date.setTime(date.getTime() + 365 * 24 * 60 * 60 * 1000);\n      expires = \"; expires=\" + date.toUTCString();\n      document.cookie = name + \"=\" + (value || \"\") + expires + \"; path=/\";\n    }\n  };\n\n  const {\n    0: session,\n    1: setSession\n  } = useState(null);\n\n  const updateSession = s => {\n    console.log('updated');\n\n    if (false) {\n      if (s.running_session !== undefined && s.running_session !== null) {\n        localStorage.setItem(\"session\", JSON.stringify(s.running_session));\n        setSession({\n          session: s.running_session\n        });\n      } else {\n        localStorage.setItem(\"session\", null);\n        router.push('/onboard').then(r => {});\n      }\n    }\n  };\n\n  const deleteSession = () => {\n    if (false) {\n      setSession(null);\n      const token = localStorage.getItem(\"token\");\n      localStorage.removeItem(\"user\");\n      localStorage.removeItem(\"token\");\n      setCookie(\"token\", \"null\");\n      localStorage.removeItem(\"session\");\n\n      if (token !== null) {\n        axios.get(URL + '/api/leave/game', {\n          headers: {\n            'Authorization': 'Bearer ' + token\n          }\n        }).then(result => {\n          router.push('/').then(res => {});\n        }).catch(error => {\n          router.push('/').then(res => {});\n        });\n      } else {\n        router.push('/').then(res => {});\n      }\n    }\n  };\n\n  const initSession = data => {\n    if (false) {\n      if (data.running_session === null) {\n        localStorage.setItem(\"session\", null);\n      } else {\n        localStorage.setItem(\"session\", JSON.stringify(data.running_session));\n      }\n\n      localStorage.setItem(\"token\", data.token);\n      setCookie(\"token\", data.token);\n      localStorage.setItem(\"user\", JSON.stringify(data.user));\n    }\n\n    setSession(data);\n\n    if (data.running_session !== null) {\n      router.push('/roadmap');\n    } else {\n      router.push('/onboard');\n    }\n  };\n\n  const clearStorage = () => {\n    localStorage.removeItem(\"user\");\n    localStorage.removeItem(\"token\");\n    setCookie(\"token\", null);\n    localStorage.removeItem(\"session\");\n  };\n\n  const value = {\n    session,\n    updateSession,\n    deleteSession,\n    initSession\n  };\n  let isAuth = false;\n  const publicPath = ['/', '/login', '/signin'];\n  const router = useRouter();\n  useEffect(() => {\n    if (false) {\n      isAuth = localStorage.getItem(\"user\") !== null;\n\n      if (!isAuth) {\n        if (!publicPath.includes(router.pathname)) {\n          deleteSession();\n          router.push('/');\n        } else {\n          deleteSession();\n          router.push('/');\n        }\n      } else {\n        let token = localStorage.getItem(\"token\");\n        let deT = jwt_decode(token);\n        let exp = deT.exp;\n        let time = Date.now() / 1000;\n\n        if (time > exp) {\n          router.push('/login');\n        } else {\n          axios.get(URL + '/api/user/info', {\n            headers: {\n              'Authorization': 'Bearer ' + token\n            }\n          }).then(result => {\n            if (result.data.data.running_session !== null) {\n              setSession({\n                session: result.data.data.running_session\n              });\n              localStorage.setItem(\"session\", JSON.stringify(result.data.data.running_session));\n\n              if (router.pathname === '/') {\n                clearStorage();\n              } else {\n                if (router.pathname.includes('onboard')) {\n                  router.push('/roadmap');\n                }\n              }\n            } else {\n              setSession({\n                session: null\n              });\n              localStorage.removeItem(\"session\");\n              router.push('/onboard');\n            }\n          }).catch(error => {\n            console.log(error);\n\n            if (error.response) {\n              if (error.response.data.code === \"invalid_jwt_token\") {\n                deleteSession();\n              } //message.warning(error.response.data.message)\n\n            } else if (error.request) {\n              console.log(error.request);\n            } else {\n              console.log('Error', error);\n            }\n          });\n        }\n      }\n    }\n  }, []);\n  const {\n    0: messages,\n    1: setMessages\n  } = useState([]);\n  const {\n    0: message,\n    1: setMessage\n  } = useState([]);\n  const socket = useSocket();\n  useEffect(() => {\n    if (socket) {\n      console.log('rr');\n      socket.on('connection', () => {\n        console.log('Connected');\n      });\n      socket.on('disconnect', reason => {\n        console.log(`Disconnected: ${reason}`);\n      });\n    }\n  }, [socket]);\n  return /*#__PURE__*/_jsx(_Fragment, {\n    children: /*#__PURE__*/_jsx(AuthContext.Provider, {\n      value: value,\n      children: children\n    })\n  });\n}","map":null,"metadata":{},"sourceType":"module"}