{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/macbookpro/Projects/web/dipongo_app/store.js\";\nimport { createContext, useContext, ReactNode, useState, useEffect } from \"react\";\nimport { useRouter } from 'next/router';\nimport jwt_decode from \"jwt-decode\";\nimport axios from \"axios\";\nimport { URL } from \"./urlapi\";\nconst authContextDefaultValues = {\n  session: null,\n  updateSession: () => {},\n  deleteSession: () => {},\n  initSession: () => {}\n};\nconst AuthContext = /*#__PURE__*/createContext(authContextDefaultValues);\nexport function useAuth() {\n  return useContext(AuthContext);\n}\nexport function AuthProvider({\n  children\n}) {\n  const {\n    0: session,\n    1: setSession\n  } = useState(null);\n\n  const updateSession = s => {\n    console.log('hey');\n\n    if (false) {\n      if (s.running_session !== undefined) {\n        localStorage.setItem(\"session\", JSON.stringify(s.running_session));\n        setSession({\n          session: s.running_session\n        });\n      }\n    }\n  };\n\n  const deleteSession = () => {\n    setSession(null);\n\n    if (false) {\n      localStorage.removeItem(\"user\");\n      localStorage.removeItem(\"token\");\n      localStorage.removeItem(\"session\");\n    }\n\n    axios.get(URL + '/api/user/info', {\n      headers: {\n        'Authorization': 'Bearer ' + token\n      }\n    }).then(result => {\n      if (result.data.data.running_session !== null) {\n        setSession({\n          session: result.data.data.running_session\n        });\n        localStorage.setItem(\"session\", JSON.stringify(result.data.data.running_session));\n\n        if (router.pathname === '/') {\n          clearStorage();\n        } else {\n          if (router.pathname.includes('onboard')) {\n            router.push('/roadmap');\n          }\n        }\n      } else {\n        setSession({\n          session: null\n        });\n        localStorage.removeItem(\"session\");\n        router.push('/onboard');\n      }\n    }).catch(error => {\n      console.log(error);\n    });\n    router.push('/');\n  };\n\n  const initSession = data => {\n    if (false) {\n      if (data.running_session === null) {\n        localStorage.setItem(\"session\", null);\n      } else {\n        localStorage.setItem(\"session\", JSON.stringify(data.running_session));\n      }\n\n      localStorage.setItem(\"token\", data.token);\n      localStorage.setItem(\"user\", JSON.stringify(data.user));\n    }\n\n    setSession(data);\n\n    if (data.running_session !== null) {\n      router.push('/roadmap');\n    } else {\n      router.push('/onboard');\n    }\n  };\n\n  const clearStorage = () => {\n    localStorage.removeItem(\"user\");\n    localStorage.removeItem(\"token\");\n    localStorage.removeItem(\"session\");\n  };\n\n  const value = {\n    session,\n    updateSession,\n    deleteSession,\n    initSession\n  };\n  let isAuth = false;\n  const publicPath = ['/', '/login', '/signin'];\n  const router = useRouter();\n  useEffect(() => {\n    if (false) {\n      isAuth = localStorage.getItem(\"user\") !== null;\n\n      if (!isAuth) {\n        if (!publicPath.includes(router.pathname)) {\n          deleteSession();\n          router.push('/');\n        } else {\n          deleteSession();\n          router.push('/');\n        }\n      } else {\n        let token = localStorage.getItem(\"token\");\n        let deT = jwt_decode(token);\n        let exp = deT.exp;\n        let time = Date.now() / 1000;\n\n        if (time > exp) {\n          router.push('/login');\n        } else {\n          axios.get(URL + '/api/user/info', {\n            headers: {\n              'Authorization': 'Bearer ' + token\n            }\n          }).then(result => {\n            if (result.data.data.running_session !== null) {\n              setSession({\n                session: result.data.data.running_session\n              });\n              localStorage.setItem(\"session\", JSON.stringify(result.data.data.running_session));\n\n              if (router.pathname === '/') {\n                clearStorage();\n              } else {\n                if (router.pathname.includes('onboard')) {\n                  router.push('/roadmap');\n                }\n              }\n            } else {\n              setSession({\n                session: null\n              });\n              localStorage.removeItem(\"session\");\n              router.push('/onboard');\n            }\n          }).catch(error => {\n            console.log(error);\n          });\n        }\n      }\n    }\n  }, []);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n      value: value,\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 166,\n      columnNumber: 13\n    }, this)\n  }, void 0, false);\n}","map":{"version":3,"sources":["/Users/macbookpro/Projects/web/dipongo_app/store.js"],"names":["createContext","useContext","ReactNode","useState","useEffect","useRouter","jwt_decode","axios","URL","authContextDefaultValues","session","updateSession","deleteSession","initSession","AuthContext","useAuth","AuthProvider","children","setSession","s","console","log","running_session","undefined","localStorage","setItem","JSON","stringify","removeItem","get","headers","token","then","result","data","router","pathname","clearStorage","includes","push","catch","error","user","value","isAuth","publicPath","getItem","deT","exp","time","Date","now"],"mappings":"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","sourcesContent":["import {createContext, useContext, ReactNode, useState, useEffect} from \"react\";\nimport { useRouter } from 'next/router'\nimport jwt_decode from \"jwt-decode\";\nimport axios from \"axios\";\nimport {URL} from \"./urlapi\";\n\nconst authContextDefaultValues = {\n    session: null,\n    updateSession: () => {},\n    deleteSession: () => {},\n    initSession: () => {},\n};\nconst AuthContext = createContext(authContextDefaultValues);\n\nexport function useAuth() {\n    return useContext(AuthContext);\n}\n\nexport function AuthProvider({ children }) {\n    const [session, setSession] = useState(null);\n    const updateSession = (s) => {\n        console.log('hey')\n        if (typeof window !== \"undefined\"){\n            if(s.running_session !== undefined){\n                localStorage.setItem(\"session\",JSON.stringify(s.running_session));\n                setSession({session: s.running_session});\n            }\n\n        }\n    };\n    const deleteSession = () => {\n        setSession(null);\n        if (typeof window !== \"undefined\"){\n            localStorage.removeItem(\"user\");\n            localStorage.removeItem(\"token\");\n            localStorage.removeItem(\"session\");\n        }\n\n        axios.get(URL + '/api/user/info', {\n            headers: {\n                'Authorization': 'Bearer ' + token\n            }\n        }).then((result)=>{\n            if(result.data.data.running_session !== null){\n                setSession({session: result.data.data.running_session})\n                localStorage.setItem(\"session\",JSON.stringify(result.data.data.running_session))\n\n                if(router.pathname === '/'){\n                    clearStorage();\n                }\n                else{\n                    if(router.pathname.includes('onboard')){\n                        router.push('/roadmap')\n                    }\n                }\n\n            }\n            else{\n                setSession({session: null})\n                localStorage.removeItem(\"session\")\n                router.push('/onboard')\n            }\n\n        }).catch((error)=>{\n            console.log(error)\n\n        });\n        router.push('/')\n    };\n    const initSession = (data) => {\n        if (typeof window !== \"undefined\"){\n            if(data.running_session === null){\n                localStorage.setItem(\"session\",null);\n            }else{\n                localStorage.setItem(\"session\",JSON.stringify(data.running_session));\n            }\n            localStorage.setItem(\"token\",data.token);\n            localStorage.setItem(\"user\",JSON.stringify(data.user));\n\n        }\n        setSession(data);\n        if(data.running_session !== null){\n           router.push('/roadmap')\n        }\n        else{\n           router.push('/onboard')\n        }\n    };\n    const clearStorage = () => {\n        localStorage.removeItem(\"user\");\n        localStorage.removeItem(\"token\");\n        localStorage.removeItem(\"session\");\n    }\n    const value = {\n        session,\n        updateSession,\n        deleteSession,\n        initSession\n    };\n    let isAuth = false;\n    const publicPath = ['/','/login','/signin'];\n    const router = useRouter()\n\n    useEffect(() => {\n        if (typeof window !== \"undefined\"){\n            isAuth  = localStorage.getItem(\"user\") !== null;\n\n           if(!isAuth){\n               if(!publicPath.includes(router.pathname)){\n                   deleteSession();\n                   router.push('/')\n               }else{\n                   deleteSession();\n                   router.push('/')\n               }\n           }\n           else{\n\n               let token = localStorage.getItem(\"token\");\n               let deT = jwt_decode(token);\n               let exp = deT.exp;\n               let time = Date.now()/1000;\n               if(time > exp){\n                   router.push('/login')\n               }\n               else\n                   {\n\n                       axios.get(URL + '/api/user/info', {\n                           headers: {\n                               'Authorization': 'Bearer ' + token\n                           }\n                       }).then((result)=>{\n                          if(result.data.data.running_session !== null){\n                              setSession({session: result.data.data.running_session})\n                              localStorage.setItem(\"session\",JSON.stringify(result.data.data.running_session))\n\n                              if(router.pathname === '/'){\n                                  clearStorage();\n                              }\n                          else{\n                                  if(router.pathname.includes('onboard')){\n                                      router.push('/roadmap')\n                                  }\n                              }\n\n                          }\n                          else{\n                              setSession({session: null})\n                              localStorage.removeItem(\"session\")\n                              router.push('/onboard')\n                          }\n\n                       }).catch((error)=>{\n                           console.log(error)\n\n                       });\n               }\n           }\n        }\n\n    }, [])\n\n    return (\n        <>\n            <AuthContext.Provider value={value}>\n                {children}\n            </AuthContext.Provider>\n        </>\n    );\n}\n"]},"metadata":{},"sourceType":"module"}